{% extends 'checkout/base.html' %}

{% block content %}
{% load humanize %}

<script type="text/javascript">
$(function () {
    $( '#items' ).searchable({
        striped: true,
        oddRow: { 'background-color': '#f5f5f5' },
        evenRow: { 'background-color': '#fff' },
        searchType: 'default'
    });
    
    $( '#searchable-container' ).searchable({
        searchField: '#container-search',
        selector: '.row',
        childSelector: '.col-xs-4',
        show: function( elem ) {
            elem.slideDown(100);
        },
        hide: function( elem ) {
            elem.slideUp( 100 );
        }
    })
})

});
</script>

<style>
#table-scroll {  
    height: 400px;
    overflow: auto;
}â€‹
</style>

<div class="col-md-12 main">
  <div class="page-header h1">{{ person.full_name }} <small>{{ person.id_number }}</small>  <span class="h4 pull-right"><a href="{% url 'checkout.views.person_history' pk=person.pk %}">View History</a></span></div>

<div class="row">
<div class="col-sm-12 col-md-12">
<div class="h3">Your Items</div>
    {% if reservations|length > 0 or person.inventory|length > 0 %}
<div class="text-muted">The following are items in your possession.</div>
          <div class="table-responsive">
            <table class="table table-striped table-condensed">
    {% if reservations|length > 0 %}
			  <thead>
				<tr>
				  <th>Reservations</th>
				  <th></th>
				  <th></th>
				  <th></th>
				</tr>
			  </thead>
			  <tbody>
              {% for reservation in reservations %}
				<tr class="warning">
				  <td>{{ reservation.item.brand }} {{ reservation.item.model }}</td>
				  <td>{{ reservation.item.serial }}</td>
				  <td>{{ reservation.item.category }}</td>
              	  <td><a  role="button" href="{% url 'checkout.views.person_cancel_reservation' reservation.pk %}">cancel reservation</a></td>
				</tr>
			  {% endfor %}
			  </tbody>
	        {% endif %}
        {% if person.inventory|length > 0 %}
			  <thead>
				<tr>
				  <th>Inventory</th>
				  <th></th>
				  <th></th>
				  <th></th>
				</tr>
			  </thead>
			  <tbody>
              {% for transaction in person.inventory %}
				<tr>
				  <td>{{ transaction.item.brand }} {{ transaction.item.model }}</td>
				  <td>{{ transaction.item.serial }}</td>
				  <td>{{ transaction.item.category }}</td>
				  <td>{{ transaction.time_out|naturaltime }}</td>
				</tr>
			  {% endfor %}
			  </tbody>
        {% endif %}
			</table>
        {% else %}
          <span class="text-muted">No items are currently checked out.</span>
        {% endif %}

<div class="h3">Available Items</div>
 <div class="row">
  <div class="col-sm-4 col-md-3">
    <form action="{% url 'checkout.views.item_search' pk=person.pk %}" method="POST">
	  {% csrf_token %}
      <input autofocus="true" text="search" name="item" id="search" value="" class="form-control" placeholder="Scan Barcode"/>
	  </div>  <!-- col -->
        <div class="col-sm-1 col-md-1">
	  OR
	  </div>  <!-- col -->
        <div class="col-sm-4 col-md-3">
<button type="button" class="btn btn-link" data-toggle="modal" data-target="#myModal">Browse Items</button>
	</form>
	  </div>  <!-- col -->
  </div>  <!-- col -->

    <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title" id="myModalLabel">Available Items</h4>
          </div>
          <div class="modal-body">
            <div id="table-scroll">
              <table id="items" class="table table-bordered table-condensed" cellspacing="0" width="100%">
                <thead> 
                  <tr>
	                <th>Item</th>
	   				<th>Serial #</th>
	   				<th>Barcode</th>
	   				<th>Category</th>
	   				<th>Description</th>
	   				<th>Action</th>
     			  </tr>
     			</thead>
     			<tbody>
     			  {% for item in available_items %}
	 				<tr> 
	   				  <td>{{ item }}</td>
	   				  <td>{{ item.serial }}</td>
	   	 			  <td>{{ item.barcode_id }}</td>
			    	  <td>{{ item.category }}</td>
	   				  <td>{{ item.description }}</td>
					  <td><a class="action-link" role="button" href="{% url 'checkout.views.reserve_item' p=person.pk i=item.pk %}">reserve</a></td>
				    </tr>
			     {% endfor %}
     			</tbody>
              </table>
    		</div>
      	  </div>
   	    <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        </div>
      </div>  <!-- modal dialog -->
    </div>  <!-- modal -->
  </div>  <!-- col -->
</div>  <!-- row -->

</div>

{% endblock content %}
