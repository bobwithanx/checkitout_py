{% extends 'checkout/base.html' %}
{% load staticfiles %}
{% load humanize %}

{% block content %}

<style>
.modal.in {
   display:block;
}
</style>

<script type="text/javascript">
	$('#myTable').DataTable( {
    "lengthChange": false,
    } );

$("#myTable tbody tr").click(function(){
    $('#search').val($(this).data('val'));
		$('.bootbox').modal('hide');
});
</script>

<div class="main person-nav">
  <div class="container">
    <div class="person-header">
      <h3>{{ person.full_name }} <small>{{ person.id_number }}</small></h3>
    </div>
    <ul class="nav nav-tabs tabnav">
      <li role="presentation" class="navigation-item selected" ><a class="navigation-link" href="{% url 'checkout.views.person_detail' id_number=person.id_number %}"><i class="fa fa-briefcase"></i> Current <span class="counter">{{ person.inventory|length }}</span></a></li>
      <li role="presentation" class="navigation-item"><a class="navigation-link" href="{% url 'checkout.views.person_history' id_number=person.id_number %}"><i class="fa fa-history"></i> History</a></li>
    </ul>
  </div>
</div>

<div class="container">
  <div class="row">
    <div class="col-md-6">
        <form action="{% url 'checkout.views.display_checkout' id_number=person.id_number %}" method="POST" role="form"  class="form-inline">
        {% csrf_token %}
          <div class="form-group">
            <input autofocus text="search" name="inventory_tag" id="search" value="" class="form-control" placeholder="Enter Inventory Tag"/>
            <button class="btn btn-success" type="submit"><i class="fa fa-fw fa-calendar-plus-o"></i> Checkout</button>
          </div>
        </form>
    </div>  
  </div>  

{% if status == "Transaction.Success" %}
  <div class="update-nag update-success">
    <div class="update-split"><i class="glyphicon glyphicon-ok"></i></div>
    <div class="update-text">{{ inventory_tag }} was successfully checked out.</div>
  </div>
{% elif status == "Transaction.Duplicate" %}
  <div class="update-nag update-info">
    <div class="update-split"><i class="glyphicon glyphicon-info-sign"></i></div>
    <div class="update-text"><strong>{{ inventory_tag }}</strong> is already checked out.</div>
  </div>

<div class="modal fade" id="myModal" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h4 class="modal-title" id="myModalLabel">Modal title</h4>
      </div>
      <div class="modal-body">
        <strong>{{ inventory_tag }}</strong> is already checked out.
  <div class="update-nag update-info">
    <div class="update-split"><i class="glyphicon glyphicon-info-sign"></i></div>
    <div class="update-text">Would you like to return the item?</div>
  </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-primary">Check In</button>
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->

<script>
$('#myModal').modal({
  show: true
});
</script>

{% elif status == "Transaction.Conflict" %}
  <div class="update-nag update-warning">
    <div class="update-split"><i class="glyphicon glyphicon-alert"></i></div>
    <div class="update-text"><strong>{{ inventory_tag }}</strong> is checked out to another person.</div>
  </div>
{% elif status == "Item.DoesNotExist" %}
  <div class="update-nag update-danger">
    <div class="update-split"><i class="glyphicon glyphicon-alert"></i></div>
    <div class="update-text"><strong>{{ inventory_tag }}</strong> cannot be found.</div>
  </div>
{% elif status == "Item.Returned" %}
  <div class="update-nag update-success">
    <div class="update-split"><i class="glyphicon glyphicon-ok"></i></div>
    <div class="update-text"><strong>{{ inventory_tag }}</strong> has been returned.</div>
  </div>
{% endif %}
{% if status == "Person.DoesNotExist" %}
  <div class="update-nag update-danger">
    <div class="update-split"><i class="glyphicon glyphicon-alert"></i></div>
    <div class="update-text">Student ID <strong>#{{ id_number }}</strong> cannot be found.</div>
  </div>
{% endif %}

  <div class="row">
    <div class="col-md-12">
      <div class="inventory-wrap">
        {% if person.inventory|length > 0 %}
        <table class="table table-hover sortable">
          <tbody>
            <thead>
              <tr class="inventory-header">
                <th>Item</th>
                <th>Inventory Tag</th>
                <th>Borrowed</th>
                <th>Actions</th>
              </tr>
            </thead>
            {% for transaction in person.inventory %}
              <tr>
                <td>					
                    <i class="fa fa-fw fa-{{ transaction.item.category.icon }} text-muted"></i>
      <a class="lightbox" data-toggle="modal" href="{% url 'checkout.views.item_popup' pk=transaction.item.pk %}" data-target="#myModal">{{ transaction.item }}</a> <span class="item-description">{{ transaction.item.description }}</span></td>
                <td class="text-muted">{{ transaction.item.inventory_tag }}</td>
                <td class="text-muted" data-toggle="tooltip" data-container="td" data-placement="top" title="{{ transaction.time_out }}">{{ transaction.time_out|naturalday }}</td>
                <td><small><i class="fa fa-calendar-check-o text-info"></i> <a href="{% url 'checkout.views.item_checkin' pk=transaction.pk %}" class="">check in</a></small></td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
        {% else %}
        <div class="blankslate blankslate-spacious blankslate-large">
          <h4>No items are checked out.</h4>
        </div>
        {% endif %}
      </div>
    </div>
  </div>

</div>

{% include 'checkout/popup.html' %}

{% endblock content %}
